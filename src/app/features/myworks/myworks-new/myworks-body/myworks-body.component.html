<div class="story-details-container">
  <div class="cover-section">
    <label class="cover-upload">
      <input type="file" (change)="onCoverSelected($event)" hidden />
      <img
        *ngIf="coverImageUrl; else placeholder"
        [src]="coverImageUrl"
        alt="Cover"
      />
      <ng-template #placeholder>
        <div class="cover-placeholder">Add a cover</div>
      </ng-template>
    </label>
  </div>

  <form [formGroup]="storyForm" (ngSubmit)="submit()" class="form-section">
    <h2>Story Details</h2>

    <label>Title </label>
    <input type="text" formControlName="title" placeholder="Untitled Story" />

    <label>Description </label>
    <textarea formControlName="description" rows="6"></textarea>

    <label>Main Characters</label>
    <div formArrayName="characters">
      <div *ngFor="let char of characters; let i = index" class="character-row">
        <input [formControlName]="i" />
        <button
          *ngIf="i !== characters.length - 1"
          type="button"
          (click)="removeCharacter(i)"
        >
          -
        </button>
        <button
          *ngIf="i === characters.length - 1"
          type="button"
          (click)="addCharacter()"
          [disabled]="areAllCharactersFilled()"
        >
          +
        </button>
      </div>
    </div>

    <label>Category </label>
    <select
      [ngModelOptions]="{ standalone: true }"
      [(ngModel)]="selectedCategory"
    >
      <option [value]="null" disabled selected>Select a category</option>
      <option *ngFor="let cat of categories" [value]="cat">
        {{ categoryLabels[cat] }}
      </option>
    </select>

    <label>Tags</label>
    <div class="tag-container">
      <span class="tag" *ngFor="let tag of tags">
        {{ tag.value }}
        <span class="remove-tag" (click)="removeTag(tag.value)">x</span>
      </span>
    </div>

    <input
      *ngIf="!tagInputVisible"
      type="text"
      [(ngModel)]="tagInput"
      [ngModelOptions]="{ standalone: true }"
      (keydown)="onTagInput($event)"
      placeholder="Separate tags with a space"
    />

    <label>Target Audience </label>
    <select
      [ngModelOptions]="{ standalone: true }"
      [(ngModel)]="selectedAudience"
    >
      <option *ngFor="let audience of audiences" [value]="audience">
        {{ audienceLabels[audience] }}
      </option>
    </select>

    <label>Language </label>
    <select
      [ngModelOptions]="{ standalone: true }"
      [(ngModel)]="selectedLanguage"
    >
      <option *ngFor="let lang of languages" [value]="lang">
        {{ languageLabels[lang] }}
      </option>
    </select>

    <label>Copyright </label>
    <select
      [ngModelOptions]="{ standalone: true }"
      [(ngModel)]="selectedLicense"
    >
      <option *ngFor="let license of licenses" [value]="license">
        {{ licenseLabels[license] }}
      </option>
    </select>

    <label class="switch-label">
      Rating (Mature)
      <div class="switch-wrapper">
        <input type="checkbox" formControlName="mature" class="switch-input" />
        <span class="switch-slider"></span>
      </div>
    </label>

    <button type="submit" [disabled]="storyForm.invalid">Save</button>
  </form>
</div>
